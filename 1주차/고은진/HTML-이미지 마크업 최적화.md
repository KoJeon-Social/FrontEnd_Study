# 이미지 마크업 최적화

<br />

## 이미지 마크업 최적화로 얻을 수 있는 것은?

이미지 파일을 최적화 시키고 `<picture>` 요소를 잘 활용하면 서버 비용을 절약할 수 있을 뿐만 아니라 사용자 경험을 크게 향상시킬 수 있다.

## 이미지 포맷 비교

- **.jpg / .png**: 모든 브라우저에서 지원하는 폴백 이미지
- **.webp**: jpg/png 대비 30~70% 수준의 용량 (알파 채널, IE 미지원)
- **.avif**: 저용량 + 고품질 (알파 채널, 크롬/삼성 인터넷 지원)

![image](https://github.com/user-attachments/assets/f37ebb09-7e11-465f-b4fa-4b8dafd7cd9f)

<br />

> **AVIF**
>
> AVIF는 최신 이미지 코덱, 즉 압축 형식으로, 현재 주류를 이루고 있는 JPG와 비교하여 품질의 손실을 최소화한 결과물을 제공한다. PNG에서만 가능하던 **투명도 조절**이 가능하며 기존 코덱들에 비해 **넓은 색 영역 및 HDR**을 제공한다. 또한 **애니메이션 이미지 제작** 또한 가능하여 GIF의 자리를 대신할 수도 있다.
>
> \*코덱: 디지털 비디오와 오디오를 위한 압축/복원 기술

<br />

## 효율적인 이미지 제공 로직

```jsx
if ('avif'를 지원하면) {
  // 'avif' 이미지 포맷 파일 출력
} else if ('webp'를 지원하면) {
  // 'webp' 이미지 포맷 파일 출력
} else {
  // 'jpg' 이미지 포맷 파일 출력
}
```

<br />

## `<picture>` 요소

<br />

> **`<picture>` 요소**
>
>`<img>` 요소의 다중 이미지 리소스를 위한 컨테이너를 정의할 때 사용
>
>- 뷰포트의 너비에 따라 커지거나 작아지는 하나의 이미지를 사용하는 대신 서로 다른 디스플레이나 기기에서 해당 뷰포트에 맞게 채워지도록 여러 이미지 중에서 적절한 이미지를 사용
>- 개발자가 이미지의 리소스를 보다 유연하게 지정할 수 있도록 해주므로 반응형 디자인에서 주로 사용한다.
>
>**`<picture>` 요소 사용법**
>
>- 0개 이상의 `<source>` 요소와 하나의 `<img>` 요소로 구성되며 브라우저는 `<source>` 요소 중에서 해당 뷰표트와 가장 잘 어울리는 `<source>` 요소를 선택한다.
>- 브라우저는 `<source>` 요소들의 속성값을 각각 확인해 나가며 조건을 만족하는 첫 번째 `<source>` 요소를 사용하고 나머지 요소들은 무시한다. 이때 `<img>` 요소는 `<picture>` 요소의 자식 요소 중에서 가장 마지막에 위치해야 한다.

<br />

**`<picture>` 요소 type 분기**

```html
<picture>
  <source srcset="sample.avif" type="image/avif" />
  <source srcset="sample.webp" type="image/webp" />
  <img src="sample.jpg" alt="sample" />
</picture>
```

- 반드시 하나의 이미지만 화면에 표시한다. 즉 사용자 환경에 알맞는 최적의 이미지만 화면에 노출하는 기능을 제공하고 있다.
- `<picture>`, `<source>` 요소들은 화면에 출력되는 요소가 아닌 `<img>` 의 소스를 제공하기 위한 요소일 뿐이다.

<br />

**`<picture>` 요소의 media 분기**

```html
<picture>
  <source srcset="small-sample.webp" media="(max-width: 960px)" />
  <img src="large-sample.webp" alt="large sample" />
</picture>
```

- `<picture>` 요소는 media 해상도 구간을 이용해 이미지를 분기할 수 있다.

<br />

**`<picture>`, `<img>` 요소 resolution 분기**

```html
<picture>
  <source srcset="2x.webp 2x, 1x.webp" type="image/webp" />
  <img srcset="2x.jpg 2x" src="1x.jpg" alt="sample" />
</picture>
```

- `<picture>`, `<img>` 요소는 사용자의 해상도, 즉 해상력으로도 분기할 수 있다.

<br />

최근 <mark>**레티나 디스플레이**</mark>라 불리는 고해상력을 가진 모니터 화면 또는 스마트폰 디스플레이들이 사용된다. 이는 **일반적인 이미지보다 두 배 더 큰 이미지를 제공하여 강제로 작게 리사이징한 다음 화면에 출력**하여 더 선명하게 보인다는 특징을 가진다.

이러한 레티나 디스플레이를 분기할 수 있는 방법이 **2x**이다. 이를 사용하면 레티나 디스플레이 해상도에서만 이 소스를 다운로드애서 화면에 출력할 수 있다.

<br />

## `<img>` 요소의 성능

```html
<img
loading="lazy" // 로딩 지연
decoding="async" // 디코딩 지연
alt="sample" />
```

- `loading=”lazy”` 속성을 사용하면 이미지를 지연 로딩한다.
  > **이미지 지연 로딩**
  > 
  >웹페이지를 화면에 출력 시 보통 뷰포트 안에 보이는 이미지만 먼저 출력하고 화면 바깥쪽의 보이지 않는 이미지들은 로딩하지 않는다. 로딩하거나 출력하지 않다가 사용자가 브라우저를 스크롤하면 아래쪽에 있는 이미지가 올라오면서 다운로드하기 시작하고 화면에 표시한다.

- `decoding=”async”` 속성을 사용하면 이미지 디코딩을 병렬로 처리한다. 이는 이미지 외의 다른 콘텐츠가 웹 페이지에 빠르게 표시되도록 도와준다.

<br />

## 이미지 요소 디버깅

![image](https://github.com/user-attachments/assets/9f29b79b-4c3b-4032-9927-38e0110e57e7)

위와 같이 이미지 요소를 디버깅하면 이 이미지가 현재 어떤 소스를 선택해서 출력하고 있는지 알 수 있다.

| **표시 종류**              | **설명**                                             |
| -------------------------- | ---------------------------------------------------- |
| **Rendered size**          | 현재 화면에 출력하고 있는 출력 사이즈                |
| **Rendered aspect ratio**  | 현재 화면에 출력하고 있는 가로 세로 출력 비율        |
| **Intrinsic size**         | 현재 화면에 출력하고 있는 소스의 원본 사이즈         |
| **Intrinsic aspect ratio** | 현재 화면에 출력하고 있는 소스의 가로 세로 원본 비율 |
| **File size**              | 이미지 파일 크기                                     |
| **Current source**         | 현재 화면에 출력하고 있는 소스                       |
